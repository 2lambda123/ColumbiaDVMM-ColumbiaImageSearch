#
# Ubuntu Dockerfile
#
# https://github.com/dockerfile/ubuntu
#

# Pull base image.
#FROM ubuntu:xenial
FROM ubuntu:trusty

# Setup and configure
ENV DEBIAN_FRONTEND noninteractive
RUN \
  apt-get update && \
  apt-get install -y --no-install-recommends apt-utils && \
  apt-get -y upgrade && \
  apt-get install locales && \
  locale-gen en_US.UTF-8 && \
  apt-get install -y build-essential --no-install-recommends && \
  apt-get install -y initramfs-tools cmake psmisc git swig wget jpeginfo libopencv-dev python-dev python-pip --no-install-recommends && \
  apt-get install -y nano less screen openssh-client

# nvidia-375 will be installed by cuda below.
#apt-get install -y cmake psmisc git swig wget jpeginfo libopencv-dev python-dev python-pip nvidia-375 --no-install-recommends && \

# Create needed directories
RUN mkdir /home/ubuntu && mkdir /home/ubuntu/memex && mkdir /home/ubuntu/memex/update && \
    mkdir /home/ubuntu/memex/ColumbiaImageSearch && mkdir /home/ubuntu/setup_cuda

# One line ENV setting
ENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 HOME=/home/ubuntu

# Cuda install not working: Driver/Library mismatch... 
# Install cuda
#COPY cuda-repo-ubuntu1604_8.0.61-1_amd64.deb /home/ubuntu/setup_cuda/
#RUN echo "Installing cuda (this may take a while)" && dpkg -i /home/ubuntu/setup_cuda/cuda-repo-ubuntu1604_8.0.61-1_amd64.deb && \
# apt-get update && apt-get -y install cuda --no-install-recommends

# Try with ubuntu14.04
COPY cuda-repo-ubuntu1404_8.0.61-1_amd64.deb /home/ubuntu/setup_cuda/
#RUN echo "Installing cuda (this may take a while)" && dpkg -i /home/ubuntu/setup_cuda/cuda-repo-ubuntu1404_8.0.61-1_amd64.deb && \
# apt-get update && apt-get -y install cuda --no-install-recommends

# need to install with the devices connected?
# apt-get -y --purge remove cuda nvidia-375 && dpkg -i /home/ubuntu/setup_cuda/cuda-repo-ubuntu1604_8.0.61-1_amd64.deb && apt-get update && apt-get -y --reinstall install cuda nvidia-375 --no-install-recommends
# apt-get -y --purge remove cuda nvidia-375 && dpkg -i /home/ubuntu/setup_cuda/cuda-repo-ubuntu1404_8.0.61-1_amd64.deb && apt-get update && apt-get -y --reinstall install cuda nvidia-375 --no-install-recommends

# We could test cuda

# Clone and compile caffe

# Define default command.
CMD ["bash"]
